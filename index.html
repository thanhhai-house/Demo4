<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>THỐNG KÊ PHỤ TÙNG</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-label="logo"></div>
      <div class="brandText">
        <div class="title">THỐNG KÊ PHỤ TÙNG</div>
        <div class="subtitle">Kho &amp; Cửa hàng • Nhập/Xuất theo OEM • Báo giá PDF</div>
      </div>
    </div>

    <div class="topActions">
      <button class="pillBtn active" id="btnKho">KHO</button>
      <button class="pillBtn" id="btnStore">CỬA HÀNG</button>
      <button class="pillBtn" id="btnAddProduct">+ THÊM SP</button>
      <span class="pill" id="authState">chưa kết nối</span>
    </div>
  </header>

  <main class="wrap">
    <section class="actionBar">
      <button class="btn primary" id="btnBaoGia">BÁO GIÁ</button>

      <div class="searchBox">
        <input id="q" placeholder="Tra theo OEM / OEM thay thế / Tên / Loại / Hãng..." />
      </div>

      <button class="btn dark" id="btnSearch">Tra cứu</button>
      <button class="btn ghost" id="btnRefresh">Làm mới</button>
      <button class="btn green" id="btnIn">Nhập hàng</button>
      <button class="btn red" id="btnOut">Xuất hàng</button>
    </section>

    <section class="subline">
      <div class="left">Đang xem: <b id="viewMode">KHO</b></div>
      <div class="right">Tick checkbox để chọn • Nhập/Xuất sẽ dùng danh sách đã tick</div>
    </section>

    <section class="card">
      <div class="cardHead">
        <div class="cardTitle">Kết quả tra cứu (<span id="resultLabel">ALL</span>)</div>
        <div class="cardRight">
          <div class="badge">Đã chọn báo giá: <b id="picked">0</b></div>
          <button class="btn ghost" id="btnClearPicked" title="Bỏ chọn hết">Bỏ chọn</button>
        </div>
      </div>

      <div class="tableWrap">
        <table id="productsTable">
          <thead>
            <tr>
              <th class="colCheck"><input type="checkbox" id="checkAll" title="Chọn tất cả" /></th>
              <th class="colImg">img</th>
              <th>id</th>
              <th>oem</th>
              <th>oem_alt</th>
              <th>name</th>
              <th>brand</th>
              <th>category</th>
              <th class="colNum">price</th>
              <th>desc</th>
            </tr>
          </thead>
          <tbody id="productsTbody">
            <tr><td colspan="10" class="emptyRow">Bấm <b>Tra cứu</b> để tải danh sách.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="belowTable">
        <div class="hint">Click dòng để tick nhanh • Click thumbnail để xem ảnh to</div>
        <div class="rightActions">
          <button class="btn dark" id="btnViewPicked">Xem danh sách đã chọn</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer chạy -->
  <div class="ticker">
    <div class="tickerTrack">
      <div class="tickerItem">© 2025 Hải Võ • Thống kê phụ tùng • Nhập/Xuất theo OEM • Báo giá PDF •</div>
      <div class="tickerItem">© 2025 Hải Võ • Thống kê phụ tùng • Nhập/Xuất theo OEM • Báo giá PDF •</div>
      <div class="tickerItem">© 2025 Hải Võ • Thống kê phụ tùng • Nhập/Xuất theo OEM • Báo giá PDF •</div>
    </div>
  </div>

  <!-- IMAGE PREVIEW MODAL -->
  <div class="modalOverlay hidden" id="imgModal">
    <div class="modal big">
      <div class="modalHead">
        <div>
          <div class="modalTitle" id="imgTitle">Ảnh sản phẩm</div>
          <div class="modalSub" id="imgSub"></div>
        </div>
        <button class="iconBtn" id="btnCloseImg" title="Đóng">✕</button>
      </div>
      <div class="modalBody">
        <div class="imgPreviewWrap">
          <img id="imgPreview" alt="preview" />
        </div>
      </div>
    </div>
  </div>

  <!-- PICKED MODAL -->
  <div class="modalOverlay hidden" id="pickedModal">
    <div class="modal big">
      <div class="modalHead">
        <div>
          <div class="modalTitle">DANH SÁCH ĐÃ CHỌN</div>
          <div class="modalSub">Copy danh sách để làm báo giá</div>
        </div>
        <button class="iconBtn" id="btnClosePicked" title="Đóng">✕</button>
      </div>

      <div class="modalBody">
        <div class="tableWrap">
          <table id="pickedTable">
            <thead>
              <tr>
                <th>id</th><th>oem</th><th>oem_alt</th><th>name</th><th>brand</th><th>category</th><th class="colNum">price</th>
              </tr>
            </thead>
            <tbody id="pickedTbody"></tbody>
          </table>
        </div>

        <div class="modalActions">
          <button class="btn ghost" id="btnCopyPicked" type="button">Copy (TSV)</button>
          <div class="grow"></div>
          <button class="btn dark" id="btnClosePicked2" type="button">Đóng</button>
        </div>
      </div>
    </div>
  </div>

  <!-- IMPORT MODAL -->
  <div class="modalOverlay hidden" id="importModal">
    <div class="modal big">
      <div class="modalHead">
        <div>
          <div class="modalTitle">NHẬP HÀNG</div>
          <div class="modalSub">Ghi STOCK + TXNS (IMPORT)</div>
        </div>
        <button class="iconBtn" id="btnCloseImport" title="Đóng">✕</button>
      </div>

      <div class="modalBody">
        <div class="formGrid">
          <label class="field"><span>Loc</span><input id="importLoc" readonly /></label>
          <label class="field"><span>Actor</span><input id="importActor" placeholder="vd: admin" /></label>
          <label class="field"><span>Note</span><input id="importNote" placeholder="ghi chú..." /></label>
        </div>

        <div class="tableWrap">
          <table>
            <thead><tr><th>id</th><th>name</th><th class="colNum">qty (+)</th><th class="colNum">price</th></tr></thead>
            <tbody id="importTbody"></tbody>
          </table>
        </div>

        <div class="modalActions">
          <button class="btn ghost" id="btnImportFillPrice" type="button">Lấy price từ PRODUCTS</button>
          <div class="grow"></div>
          <button class="btn dark" id="btnDoImport" type="button">Ghi NHẬP</button>
        </div>
      </div>
    </div>
  </div>

  <!-- EXPORT MODAL -->
  <div class="modalOverlay hidden" id="exportModal">
    <div class="modal big">
      <div class="modalHead">
        <div>
          <div class="modalTitle">XUẤT HÀNG / TẠO HÓA ĐƠN</div>
          <div class="modalSub">Ghi BILLS + BILL_ITEMS + TXNS và trừ STOCK</div>
        </div>
        <button class="iconBtn" id="btnCloseExport" title="Đóng">✕</button>
      </div>

      <div class="modalBody">
        <div class="formGrid">
          <label class="field"><span>Loc</span><input id="exportLoc" readonly /></label>
          <label class="field"><span>Actor</span><input id="exportActor" placeholder="vd: admin" /></label>
          <label class="field"><span>Note</span><input id="exportNote" placeholder="ghi chú..." /></label>
        </div>

        <div class="tableWrap">
          <table>
            <thead><tr><th>id</th><th>name</th><th class="colNum">qty (-)</th><th class="colNum">price</th><th class="colNum">line_total</th></tr></thead>
            <tbody id="exportTbody"></tbody>
          </table>
        </div>

        <div class="modalActions">
          <div class="pill">Tổng: <b id="exportTotal">0</b></div>
          <div class="grow"></div>
          <button class="btn ghost" id="btnExportFillPrice" type="button">Lấy price từ PRODUCTS</button>
          <button class="btn red" id="btnDoExport" type="button">TẠO HÓA ĐƠN</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADD PRODUCT MODAL (ID có thể để trống) -->
  <div class="modalOverlay hidden" id="addProductModal">
    <div class="modal big">
      <div class="modalHead">
        <div>
          <div class="modalTitle">THÊM / SỬA SẢN PHẨM</div>
          <div class="modalSub">Để trống ID thì hệ thống tự tạo (P000001...)</div>
        </div>
        <button class="iconBtn" id="btnCloseAddProduct" title="Đóng">✕</button>
      </div>

      <div class="modalBody">
        <div class="formGrid">
          <label class="field"><span>id (optional)</span><input id="p_id" placeholder="để trống để tự tạo" /></label>
          <label class="field"><span>oem</span><input id="p_oem" /></label>
          <label class="field"><span>oem_alt</span><input id="p_oem_alt" /></label>
        </div>

        <div class="formGrid">
          <label class="field"><span>name</span><input id="p_name" /></label>
          <label class="field"><span>brand</span><input id="p_brand" /></label>
          <label class="field"><span>category</span><input id="p_category" /></label>
        </div>

        <div class="formGrid">
          <label class="field"><span>price</span><input id="p_price" type="number" min="0" step="1" /></label>
          <label class="field"><span>image_url</span><input id="p_image_url" placeholder="tự điền khi upload" /></label>
          <label class="field"><span>image_file_id</span><input id="p_image_file_id" placeholder="tự điền khi upload" /></label>
        </div>

        <div class="formGrid">
          <label class="field">
            <span>Chọn ảnh (upload Drive)</span>
            <input id="p_image_file" type="file" accept="image/*" />
          </label>

          <div class="field" style="grid-column: span 2;">
            <span>Xem trước</span>
            <div class="imgPreviewWrap" style="min-height:220px;">
              <img id="p_image_preview" alt="preview" />
            </div>
          </div>
        </div>

        <label class="field">
          <span>desc</span>
          <input id="p_desc" placeholder="mô tả..." />
        </label>

        <div class="modalActions">
          <button class="btn ghost" id="btnClearProduct" type="button">Xóa form</button>
          <div class="grow"></div>
          <button class="btn dark" id="btnSaveProduct" type="button">Lưu PRODUCT</button>
        </div>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
